@page "/"
@using System.Text

<PageTitle>Home</PageTitle>

<div class="input-group mb-3">
	<input @bind="password" readonly="readonly" type="text" class="form-control" aria-label="Recipient's username" aria-describedby="basic-addon2">
	<span @onmouseenter="@((changeEv) =>@onEmojiHover("copy"))" 
		  @onmouseleave="@onEmojiMouseLeave"
		  class="input-group-text my-clickable-button @onHoverCopyCss" id="basic-addon2">
		📄
	</span>

	<span @onclick="@handleGeneratePasswordClick"
		  @onmouseenter="@(() =>@onEmojiHover("generate"))" 
		  @onmouseleave="@onEmojiMouseLeave"
		  class="input-group-text my-clickable-button @onHoverGenerateCss" id="basic-addon3">
		🔄
	</span>

	<span @onclick="@handleSavePasswordClick"
		  @onmouseenter="@(() =>@onEmojiHover("save"))" 
		  @onmouseleave="@onEmojiMouseLeave"
		  class="input-group-text my-clickable-button @onHoverSaveCss" id="basic-addon4">
		💾
	</span>
</div>


<div class="card">
	<div class="card-header">
		💾 Saved Passwords
	</div>

	<div class="card-body">
		<ul class="list-group mt-3">
			@foreach(var savedPassword in savedPasswords)
			{
				<li class="list-group-item">@savedPassword</li>
			}
		</ul>
	</div>
	
</div>


@code {
	private string password = string.Empty;
	private int passwordLenght = 6;
	private HashSet<String> savedPasswords = [];


	private string onHoverCopyCss = string.Empty;
	private string onHoverGenerateCss = string.Empty;
	private string onHoverSaveCss = string.Empty;

	private static Random random = new Random();
	private static StringBuilder stringBuilder = new StringBuilder();

	private bool includeLowercase = true;
	private bool includeUppercase = true;
	private bool includeNumbers = true;
	private bool includeSpecialChars = true;

	private const string lowercaseLetters = "abcdefghijklmnopqrstuvwxyz";
	private const string uppercaseLetters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	private const string numbers = "0123456789";
	private const string specialCharacters = "!@#$%&*()_+-={};:?";

	private void handleSavePasswordClick()
	{
		if (string.IsNullOrEmpty(password) || savedPasswords.Any(x=> x==password))
			return;


		savedPasswords.Add(password);

	}

	private void handleGeneratePasswordClick()
	{
		var validChars = new StringBuilder();

		if (includeLowercase)
			validChars.Append(lowercaseLetters);

		if (includeUppercase)
			validChars.Append(uppercaseLetters);

		if (includeNumbers)
			validChars.Append(numbers);

		if (includeSpecialChars)
			validChars.Append(specialCharacters);


		stringBuilder.Clear();

		for (int i = 0; i < passwordLenght; i++)
		{
			var randomIndex = random.Next(0, validChars.Length);

			stringBuilder.Append(validChars[randomIndex]);
		}

		password = stringBuilder.ToString();
	}


	private void onEmojiHover(string iconType)
	{
		switch (iconType)
		{
			case "copy":
				onHoverCopyCss = "bg-secondary";
				break;


			case "generate":
				onHoverGenerateCss = "bg-secondary";
				break;


			case "save":
				onHoverSaveCss = "bg-secondary";
				break;


			default:

				break;
		}
	}

	private void onEmojiMouseLeave()
	{
		onHoverCopyCss = string.Empty;
		onHoverGenerateCss = string.Empty;
		onHoverSaveCss = string.Empty;
	}
}
